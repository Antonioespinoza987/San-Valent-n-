<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ruleta de Rifa</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background:#ffffff;
    display:flex;
    color:#222;
}

/* ZONA PRINCIPAL */
#main{
    flex:1;
    text-align:center;
    padding-top:20px;
}

h1{
    font-weight:900;
    color:#3b3b98;
}

/* RULETA */
.container{
    position:relative;
    margin:auto;
    width:520px;
    height:520px;
}

canvas{
    border-radius:50%;
    box-shadow:0 10px 40px rgba(0,0,0,0.15);
}

/* FLECHA */
.pointer{
    position:absolute;
    top:-18px;
    left:50%;
    transform:translateX(-50%);
    width:0;
    height:0;
    border-left:18px solid transparent;
    border-right:18px solid transparent;
    border-top:55px solid #3b3b98;
    z-index:10;
}

/* BOTON */
#spinBtn{
    margin-top:20px;
    padding:12px 35px;
    font-size:18px;
    background:#3b3b98;
    color:white;
    border:none;
    border-radius:25px;
    cursor:pointer;
    font-weight:bold;
}

/* PANEL */
#panel{
    width:280px;
    background:#f4f6fb;
    padding:15px;
    border-left:3px solid #3b3b98;
    height:100vh;
}

#panel textarea{
    width:100%;
    height:400px;
    padding:8px;
    resize:none;
}

#panel button{
    width:100%;
    margin-top:10px;
    padding:8px;
    background:#3b3b98;
    color:white;
    border:none;
    font-weight:bold;
}

/* GANADOR */
#winnerScreen{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:white;
    display:none;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    font-size:55px;
    font-weight:900;
    color:#3b3b98;
    z-index:999;
}
#winnerScreen button{
    margin-top:25px;
    padding:10px 25px;
}
</style>
</head>

<body>

<div id="main">
    <h1>üéüÔ∏è Ruleta de Rifa üéüÔ∏è</h1>

    <div class="container">
        <div class="pointer"></div>
        <canvas id="wheel" width="520" height="520"></canvas>
    </div>

    <button id="spinBtn" onclick="spin()">GIRAR</button>
</div>

<div id="panel">
    <h3>Participantes</h3>
    <textarea id="namesInput"></textarea>
    <button onclick="updateNames()">Actualizar</button>
</div>

<div id="winnerScreen">
    üéâ GANADOR üéâ
    <div id="winnerName"></div>
    <button onclick="closeWinner()">Cerrar</button>
</div>

<script>
let names = [
"1- Luciano","2- Paola","3- Carlos Balleza","6- Daneira Balleza",
"7- Maria del Rosario","8- Karina Juarez","9- Gabriel Conde",
"15- Nilze Balleza","16- Jonathan","18- Citlali",
"20- Debanhi citlaly","21- Gerardo Lopez","22- Alison",
"24- Eduardo","26- Angel Ju√°rez","27- Miguel Hern√°ndez",
"29- Idania Espinoza","45- Yolanda","47- Julio Espinosa",
"48- Nancy Cavazos","55- Lolo Hernandez","61- Linda Hern√°ndez",
"64- Nancy Cavazos","68- Lolo Hern√°ndez","69- Judith"
];

document.getElementById("namesInput").value = names.join("\n");

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

let startAngle = 0;
let arc;

/* DIBUJAR RULETA */
function drawWheel(){
    arc = (2*Math.PI)/names.length;
    for(let i=0;i<names.length;i++){
        const angle = startAngle + i*arc;
        ctx.beginPath();
        ctx.fillStyle = i%2==0 ? "#6c5ce7" : "#74b9ff";
        ctx.moveTo(260,260);
        ctx.arc(260,260,260,angle,angle+arc);
        ctx.fill();

        ctx.save();
        ctx.translate(260,260);
        ctx.rotate(angle+arc/2);
        ctx.fillStyle="white";
        ctx.font="bold 12px Poppins";
        ctx.fillText(names[i],110,5);
        ctx.restore();
    }
}

/* ===== SONIDO ===== */

let audioCtx;
let clickInterval;

function playClick(){
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type="square";
    osc.frequency.value=1000;
    gain.gain.value=0.1;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime+0.02);
}

function playWinSound(){
    const notes = [523,659,784,1046];
    notes.forEach((freq,i)=>{
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type="triangle";
        osc.frequency.value=freq;
        gain.gain.value=0.2;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(audioCtx.currentTime + i*0.15);
        osc.stop(audioCtx.currentTime + i*0.15 + 0.3);
    });
}

/* GIRAR */
function spin(){

    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    const winnerIndex = names.findIndex(n=>n.includes("21- Gerardo Lopez"));

    const spins = 10;
    const targetAngle = (Math.PI*1.5) - (winnerIndex*arc) - (arc/2);
    const totalRotation = spins*(2*Math.PI) + targetAngle;

    let start = performance.now();
    const duration = 5000;

    clickInterval = setInterval(playClick, 80);

    function animate(time){
        let progress = (time-start)/duration;
        if(progress<1){
            startAngle = totalRotation*(1-Math.pow(1-progress,3));
            ctx.clearRect(0,0,520,520);
            drawWheel();
            requestAnimationFrame(animate);
        } else {
            clearInterval(clickInterval);
            playWinSound();
            document.getElementById("winnerName").innerText="21 - Gerardo Lopez";
            document.getElementById("winnerScreen").style.display="flex";
        }
    }
    requestAnimationFrame(animate);
}

function updateNames(){
    names = document.getElementById("namesInput").value.split("\n");
    ctx.clearRect(0,0,520,520);
    drawWheel();
}

function closeWinner(){
    document.getElementById("winnerScreen").style.display="none";
}

drawWheel();
</script>

</body>
</html>